# Claude Code 深度技巧 - 10个月日常使用后的完整配置

## 概述

本指南是作者经过10个月每天使用 Claude Code 后总结的完整配置手册。想象一下，你买了一台很贵的咖啡机，这本手册就是教你如何把这台机器调教到最好状态——哪个豆子最香、水温多少最合适、怎么保养让它用得更久。

## Skills（技能）- 就像餐厅的快捷菜单

**是什么：** 预设好的"指令模板"，就像你在餐厅点餐时看到的套餐菜单。

**通俗类比：** 想象你是一家餐厅的老板。每天客人点菜时，有些人总是点一样的套餐（比如"商务午餐"）。与其每次都记下一长串菜名，不如直接说"来个套餐1"。

在 Claude Code 里也是一样：与其每次都让 AI 做一整套复杂操作，不如把这些操作打包成一个"技能"，下次直接喊它的名字就行。

**实际使用：**
- `/refactor-clean` = "帮我收拾房间"（清理死代码和无用文件）
- `/tdd` = "按测试驱动开发的方式干活"
- `/e2e` = "帮我跑一遍完整的端到端测试"

**文件位置：** `~/.claude/skills/` （就像你的菜谱文件夹）

### 命令 vs 技能

**Commands（命令）** = 技能的一种特殊形式，通过 `/` 开头的快捷方式调用

**类比：**
- **技能** = 完整的菜谱卡片（比如"红烧肉做法"）
- **命令** = 菜单上的快捷按钮（比如"厨师推荐"）

两者本质一样，就是放的地方不同。

## Hooks（钩子）- 就像智能闹钟和自动化规则

**是什么：** 在特定事件发生时自动触发的动作。

**通俗类比：** 想象你的智能家居系统：
- 当你**打开前门**时（事件），玄关灯**自动亮起**（钩子）
- 当你**离开家**时（事件），空调**自动关闭**（钩子）
- **晚上10点**时（事件），手机**提醒你睡觉**（钩子）

在 Claude Code 里：
- 当你**运行 npm 命令**前（事件），**提醒你用 tmux**（钩子）
- 当你**修改完代码**后（事件），**自动格式化**（钩子）

### 钩子类型（6种触发时机）

1. **PreToolUse** - 工具执行前（就像"离开家前检查煤气"）
2. **PostToolUse** - 工具执行后（就像"运动后拉伸"）
3. **UserPromptSubmit** - 你发送消息时（就像"发送邮件前检查附件"）
4. **Stop** - Claude 完成响应时（就像"挂电话前说再见"）
5. **PreCompact** - 上下文压缩前（就像"收拾房间前先整理"）
6. **Notification** - 权限请求时（就像"访客到来时通知你"）

### 实用示例

**场景：** 你要运行一个需要很长时间的命令（比如安装依赖）

**问题：** 如果直接运行，一旦关闭终端，程序就停了

**钩子解决方案：** 系统检测到你要运行 `npm install` 这类长时间命令时，自动提醒你："嘿，用 tmux 吧，这样关闭终端程序也能继续跑"

## Subagents（子代理）- 就像专科医生团队

**是什么：** 具有特定专业能力的"小助手"，主 Claude 可以把任务委托给它们。

**通俗类比：** 想象你在医院：
- 你先看**全科医生**（主 Claude）
- 全科医生发现你需要眼科治疗，就把你转给**眼科医生**（子代理1）
- 需要心理咨询时，转给**心理医生**（子代理2）
- 需要手术时，转给**外科医生**（子代理3）

每个专科医生只负责自己领域的事，不会越界。

**在 Claude Code 中：**
- **planner.md** = 项目经理（负责规划任务）
- **architect.md** = 建筑师（负责系统设计）
- **security-reviewer.md** = 安全专家（负责检查漏洞）
- **code-reviewer.md** = 质检员（负责代码质量）

**好处：** 每个子代理专注于自己的领域，不会"什么都知道一点，什么都不精"。

## Rules（规则）- 就像公司的员工手册

**是什么：** Claude 必须**始终遵守**的规则，写在 `.md` 文件里。

**通俗类比：** 想象你开了一家公司：
- 你给员工写了一本《员工手册》
- 里面写着："必须穿正装"、"不准迟到"、"客户投诉必须在24小时内响应"

**在 Claude Code 中：**
- `security.md` = 安全规则（比如"不能在代码里写密码"）
- `coding-style.md` = 编码风格（比如"文件不能超过500行"）
- `testing.md` = 测试规则（比如"测试覆盖率要达到80%"）

### 两种组织方式

1. **单一文件** = 把所有规则写在一张纸上（适合小团队）
2. **规则文件夹** = 分类整理到不同文件夹（比如"人事规则"、"财务规则"、"安全规则"）

## MCPs（Model Context Protocol，模型上下文协议）- 就像翻译官和中介

**是什么：** 让 Claude 能和外部服务（如数据库、GitHub）对话的"桥梁"。

**通俗类比：** 想象你去国外旅游：
- 你不会说当地语言
- 你请了一个**翻译官**（MCP）
- 翻译官帮你和当地人对话：你用中文说，翻译官转成当地语言，当地人回答后，翻译官再翻译回中文

**在 Claude Code 中：**
- **GitHub MCP** = 翻译官帮你和 GitHub 对话（查看 PR、创建 issue）
- **Supabase MCP** = 翻译官帮你和数据库对话（查询数据、运行 SQL）
- **Vercel MCP** = 翻译官帮你和部署平台对话

**重要：** MCP 不是直接连接，而是通过"提示词"来操作，就像你对翻译官说"帮我问当地人..."，翻译官再去问。

### Chrome in Claude

**是什么：** 一个特殊的 MCP，让 Claude 能控制你的浏览器

**通俗类比：** 就像你雇了一个远程助手，他可以通过网络控制你电脑上的浏览器，帮你点按钮、看网页内容。

## 上下文窗口（Context Window）- 就像书桌的大小

**是什么：** Claude 能"记住"的对话内容总量，用"token 数量"衡量。

**通俗类比：** 想象你在书桌前工作：
- **小书桌**（上下文小）= 只能放几本书，放多了就得把旧的收起来
- **大书桌**（上下文大）= 可以堆很多书，都能看到

**Claude Code 的上下文窗口：**
- 标准大小：**200k tokens**（约15万字）
- 启用太多工具后：可能只剩 **70k tokens**（约5万字）

**问题：** 启用太多 MCP 和插件会"挤占"你的书桌空间

**解决方案：**
- 安装20-30个 MCP（就像把书放在书架上）
- 但只启用5-10个（就像只拿几本到书桌上）

**经验法则：**
- 配置的 MCP：20-30个
- 同时启用：10个以下
- 活跃工具总数：80个以下

## Plugins（插件）- 就像手机的 App

**是什么：** 打包好的功能模块，一键安装就能用。

**通俗类比：** 想象你的智能手机：
- 你想**听音乐**，就去应用商店下载"网易云音乐"
- 你想**导航**，就下载"高德地图"
- 你想**聊天**，就下载"微信"

**在 Claude Code 中：**
- **typescript-lsp** = TypeScript 智能助手（帮你检查代码错误）
- **hookify** = 钩子生成器（不用手写代码，用对话方式创建钩子）
- **mgrep** = 高级搜索（比普通搜索更强大）

### LSP（Language Server Protocol，语言服务器协议）

**是什么：** 让 Claude 能"理解"代码结构的工具。

**通俗类比：** 想象你在读一本外文书：
- **没有 LSP** = 你只能看到单词，不知道哪个词对应哪页、哪里有引用
- **有 LSP** = 就像有个助手，随时告诉你"这个词在第50页出现过"、"这个概念在第10章讲过"

**实际好处：**
- **实时类型检查** = 写代码时立刻发现错误（像 Word 的拼写检查）
- **转到定义** = 点击函数名，直接跳到函数定义的地方
- **智能补全** = 你写一半，它猜你要写什么

## 键盘快捷键 - 就像琴谱的指法

**是什么：** 不用鼠标就能快速操作的按键组合。

**常用快捷键：**
- `Ctrl+U` = 删除整行（像橡皮擦，一次擦一整行）
- `!` = 快速执行命令（像按"呼叫服务员"按钮）
- `@` = 搜索文件（像图书管理员帮你找书）
- `/` = 启动斜杠命令（像按下"菜单"键）
- `Tab` = 切换"思考显示"（像开关灯）

## 并行工作流 - 就像多开窗口

### `/fork` 命令

**是什么：** 创建"分身"，同时做多件事。

**通俗类比：** 想象你在厨房：
- **不用 fork** = 你一个人，切完菜再炒菜，炒完菜再煲汤（串行，很慢）
- **用 fork** = 你雇了3个助手，一个切菜、一个炒菜、一个煲汤（并行，很快）

### Git Worktrees（Git 工作树）

**是什么：** 同一个项目的多个"平行宇宙"版本。

**通俗类比：** 想象你在写论文：
- **主版本** = 在桌面上的"论文最终版.docx"
- **工作树1** = 在桌面文件夹"实验A"里的"论文.docx"（尝试改结构）
- **工作树2** = 在桌面文件夹"实验B"里的"论文.docx"（尝试改内容）

三个文件互不影响，你可以同时在不同版本上工作。

**实际使用：**
```bash
git worktree add ../feature-branch feature-branch
# 现在有两个"平行宇宙"了，各干各的
```

## tmux - 就像"屏幕录像机"

**是什么：** 一个可以"断线重连"的终端管理器。

**通俗类比：** 想象你在看电视：
- **不用 tmux** = 关电视，节目就没了，下次得从头看
- **用 tmux** = 像用录像机，关电视后节目继续录，下次打开可以接着看

**实际场景：**
- 你要运行一个需要跑10小时的程序
- 如果直接运行，电脑一休眠程序就停了
- 用 tmux，程序在后台继续跑，你随时可以"接回去"看进度

```bash
tmux new -s dev          # 创建一个叫"dev"的"录像"
tmux attach -t dev       # 重新连接到这个"录像"
```

## mgrep - 就像图书目录+搜索

**是什么：** 比普通搜索更强大的搜索工具。

**通俗类比：**
- **普通 grep** = 像在一堆纸里翻，一张张看
- **mgrep** = 像有个图书管理员，立刻告诉你"在第3页第5行"

**两种模式：**
```bash
mgrep "function handleSubmit"        # 在你的项目里搜索
mgrep --web "Next.js 15 新特性"      # 在整个互联网搜索
```

## 其他有用命令

- `/rewind` = 时间倒流（回到之前的状态）
- `/statusline` = 自定义状态栏（显示你关心的信息）
- `/checkpoints` = 存档点（像游戏的存档，随时可以读档）
- `/compact` = 手动整理书桌（清理不需要的记忆）

## GitHub Actions CI/CD - 就像自动传送带

**是什么：** 当你提交代码后，自动进行测试、审查、部署的流程。

**通俗类比：** 想象一个工厂的传送带：
1. 工人放零件（你提交代码）
2. 传送带自动送到**质检站**（自动测试）
3. 质检通过后送到**包装站**（代码审查）
4. 最后送到**发货站**（部署上线）

**好处：** 你只管"生产代码"，剩下的测试、审查、部署都是自动的。

## 沙箱隔离（Sandbox）- 就像隔离实验室

**是什么：** 让 Claude 在一个"虚拟环境"里运行，不会影响你的真实系统。

**通俗类比：**
- **不用沙箱** = 直接在你家做化学实验，炸了就把家炸了
- **用沙箱** = 在专门的实验室做实验，炸了也只是实验室受损，你家没事

**危险模式：** `--dangerously-skip-permissions` = 取消所有限制（让化学家在你家客厅做实验，很危险！）

## 编辑器集成 - 就像工作台和工具箱

### Zed（推荐）

**是什么：** 一个用 Rust 语言写的、超快的代码编辑器。

**通俗类比：**
- **Zed** = 专业木匠的工作台（轻便、快速、工具齐全）
- **其他编辑器** = 普通桌子（可能比较重、反应慢）

**为什么 Zed 和 Claude Code 配合好：**
1. **Agent Panel** = 实时看到 Claude 在改哪个文件（像木匠看到助手在拿什么工具）
2. **快速启动** = 像开灯一样瞬间打开
3. **命令面板** = 按 CMD+Shift+R 看所有快捷命令（像遥控器）
4. **省资源** = 不会和 Claude 抢电脑资源（像两个工人不互相干扰）

### VSCode / Cursor

**是什么：** 另一个流行的编辑器，也可以和 Claude Code 配合使用。

**两种用法：**
1. **终端模式** = 就像用对讲机沟通
2. **扩展模式** = 就像面对面沟通（更直观）

## 完整配置示例

### 已安装的插件（一次启用 4-5 个）

**就像你的手机应用：**
```markdown
ralph-wiggum        # 自动循环处理（像洗衣机自动循环）
frontend-design     # UI/UX 设计建议（像室内设计师）
commit-commands     # Git 提交助手（像秘书帮你写邮件）
typescript-lsp      # TypeScript 智能提示（像语法检查器）
hookify             # 钩子生成器（像对话式机器人）
mgrep               # 高级搜索（像超级搜索引擎）
```

### MCP 服务器配置

**就像你手机里的联系人：**
```json
{
  "github": "GitHub 官方账号",
  "firecrawl": "网页抓取服务",
  "supabase": "数据库服务",
  "vercel": "部署平台",
  "railway": "另一个部署平台"
}
```

**关键原则：**
- 通讯录里有20-30个联系人（配置了这些 MCP）
- 但只和5-6个保持密切联系（只启用这几个）
- 这样手机才不会卡（上下文窗口健康）

### 关键钩子配置

**就像你设置的自动化规则：**
```json
{
  "PreToolUse": [
    "运行长时间命令前，提醒我用 tmux",
    "创建 .md 文件前，问我是不是真的需要",
    "git push 前，让我先检查一遍"
  ],
  "PostToolUse": [
    "修改代码后，自动格式化",
    "修改 TypeScript 代码后，检查类型错误",
    "修改代码时，如果看到 console.log 就警告我"
  ],
  "Stop": [
    "工作结束前，检查有没有遗留的 console.log"
  ]
}
```

### 规则结构

**就像公司的规章制度：**
```bash
~/.claude/rules/
├── security.md       # 安全规则（不能泄露密码）
├── coding-style.md   # 编码风格（代码要整洁）
├── testing.md        # 测试规则（测试要覆盖80%）
├── git-workflow.md   # Git 工作流（提交信息格式）
└── performance.md    # 性能规则（什么时候用哪个 AI 模型）
```

### 子代理结构

**就像医院的不同科室：**
```bash
~/.claude/agents/
├── planner.md              # 项目经理（规划任务）
├── architect.md            # 建筑师（设计系统）
├── tdd-guide.md            # 测试教练（指导写测试）
├── code-reviewer.md        # 质检员（检查代码质量）
├── security-reviewer.md    # 安全专家（检查漏洞）
└── refactor-cleaner.md     # 清洁工（清理无用代码）
```

## 核心要点（5条黄金法则）

1. **不要过度复杂化**
   - 类比：做饭只需要必要的厨具，不需要买一堆用不上的小电器
   - 配置像"调味"，要一点点调整，不要一次放太多

2. **上下文窗口很宝贵**
   - 类比：书桌大小有限，不要把所有书都摊开
   - 禁用不用的 MCP 和插件，保持书桌整洁

3. **并行执行**
   - 类比：多雇几个人同时干活，比一个人干完再干下一个快
   - 用 `/fork` 分支对话，用 git worktree 创建平行版本

4. **自动化重复任务**
   - 类比：每天都要做的事，设个闹钟自动提醒
   - 用钩子自动格式化、检查代码、提醒事项

5. **限制子代理范围**
   - 类比：医生分工明确，眼科不管心脏，心脏不管骨科
   - 每个子代理只做自己的专长，别让它什么都管

---

## 总结：一个生活化的完整类比

**想象你在经营一家餐厅：**

1. **Skills（技能）** = 你写在卡片上的"招牌菜配方"（比如"宫保鸡丁套餐"）
2. **Hooks（钩子）** = 你设置的自动化规则（比如"客人进店自动播放欢迎音乐"）
3. **Subagents（子代理）** = 你雇的专业团队（厨师长、服务员、收银员各司其职）
4. **Rules（规则）** = 你的《员工手册》（比如"必须穿制服"、"不准迟到"）
5. **MCPs** = 你的外部合作伙伴（送菜公司、清洁公司、装修公司）
6. **上下文窗口** = 你的厨房台面大小（台面有限，别堆太多东西）
7. **Plugins（插件）** = 你买的现成厨具（不用自己造，买来就能用）
8. **编辑器集成** = 你的餐厅布局（厨房和餐厅怎么配合）
9. **并行工作流** = 你同时让多个厨师干活
10. **tmux** = 你的监控摄像头（关店后也能看到厨房在干嘛）

**最终目标：** 就像经营一家高效的餐厅，配置好 Claude Code 后，你就像有个"超级助手团"，帮你自动完成各种开发任务。

---

*来源：[@affaanmustafa 在 X/Twitter](https://x.com/affaanmustafa/status/2012378465664745795)*
*本文由文科生友好的比喻改编*
